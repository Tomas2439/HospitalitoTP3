<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <script>
        // Aplicar tema antes del renderizado (evita flash blanco)
        (function() {
            try {
                const savedTheme = localStorage.getItem('theme');
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

                if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            } catch (e) {
                console.error('Error aplicando tema:', e);
            }
        })();
    </script>
    <meta charset="utf-8" />
    <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
    <link as="style" href="https://fonts.googleapis.com/css2?display=swap&family=Inter:wght@400;500;700;900"
          onload="this.rel='stylesheet'" rel="stylesheet"/>
    <title>Hospital Lito - Gestión de Enfermeras</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#11a4d4',
                        'background-light': '#f6f8f8',
                        'background-dark': '#101d22',
                    },
                    fontFamily: { display: ['Inter'] },
                    borderRadius: { DEFAULT: '0.25rem', lg: '0.5rem', xl: '0.75rem', full: '9999px' },
                },
            },
        };
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
</head>
<body class="bg-background-light dark:bg-background-dark font-display">
<div class="flex h-screen">

    <!-- ============================
         Sidebar
    ============================ -->
    <aside class="flex w-64 flex-col bg-background-light dark:bg-background-dark border-r border-primary/20 dark:border-primary/30">
        <div class="flex h-20 items-center gap-3 px-6">
            <div class="text-primary w-8 h-8">
                <svg fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                    <path d="M24 45.8096C19.6865 45.8096 15.4698 44.5305 11.8832 42.134C8.29667 39.7376 5.50128 36.3314 3.85056 32.3462C2.19985 28.361 1.76794 23.9758 2.60947 19.7452C3.451 15.5145 5.52816 11.6284 8.57829 8.5783C11.6284 5.52817 15.5145 3.45101 19.7452 2.60948C23.9758 1.76795 28.361 2.19986 32.3462 3.85057C36.3314 5.50129 39.7376 8.29668 42.134 11.8833C44.5305 15.4698 45.8096 19.6865 45.8096 24L24 24L24 45.8096Z" fill="currentColor"></path>
                </svg>
            </div>
            <h1 class="text-xl font-bold text-black dark:text-white">Hospital Lito</h1>
        </div>
        <!-- MODO OSCURO -->
        <div class="px-4 pb-4">
            <button id="darkModeToggle"
                    class="flex w-full items-center justify-between gap-3 rounded-lg px-4 py-2.5 text-black dark:text-white hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined">dark_mode</span>
                    <span class="text-sm font-medium">Modo oscuro</span>
                </div>
                <!-- Toggle switch -->
                <div class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-300 dark:bg-primary transition-colors">
                    <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-1 dark:translate-x-6"></span>
                </div>
            </button>
        </div>
        <nav class="flex-1 space-y-2 px-4">
            <a class="flex items-center gap-3 rounded-lg px-4 py-2.5 text-black dark:text-white hover:bg-primary/20 dark:hover:bg-primary/30" th:href="@{/hospitalito}">
                <span class="material-symbols-outlined">dashboard</span>
                <span class="text-sm font-medium">Dashboard</span>
            </a>
            <a class="flex items-center gap-3 rounded-lg px-4 py-2.5 text-black dark:text-white hover:bg-primary/20 dark:hover:bg-primary/30" th:href="@{/hospitalito/asignaciones}">
                <span class="material-symbols-outlined">assignment_ind</span>
                <span class="text-sm font-medium">Asignaciones</span>
            </a>
            <a class="flex items-center gap-3 rounded-lg bg-primary/20 dark:bg-primary/30 px-4 py-2.5 text-black dark:text-white" th:href="@{/hospitalito/enfermeras}">
                <span class="material-symbols-outlined">badge</span>
                <span class="text-sm font-medium">Enfermeras</span>
            </a>
            <a class="flex items-center gap-3 rounded-lg px-4 py-2.5 text-black dark:text-white hover:bg-primary/20 dark:hover:bg-primary/30" th:href="@{/hospitalito/camas}">
                <span class="material-symbols-outlined">bed</span>
                <span class="text-sm font-medium">Camas</span>
            </a>
            <a class="flex items-center gap-3 rounded-lg px-4 py-2.5 text-black dark:text-white hover:bg-primary/20 dark:hover:bg-primary/30" th:href="@{/hospitalito/pacientes}">
                <span class="material-symbols-outlined">personal_injury</span>
                <span class="text-sm font-medium">Pacientes</span>
            </a>
        </nav>

        <div class="p-4">
            <div class="flex items-center gap-3">
                <div>
                    <p class="text-sm font-semibold text-black dark:text-white" th:text="${usuarioLogueado}"></p>
                    <p class="text-xs text-black/60 dark:text-white/60">Administrator</p>
                </div>
                <form th:action="@{/logout}" method="post" id="logoutForm" style="display:none;"></form>
                <a href="#" class="ml-auto text-black dark:text-white" onclick="document.getElementById('logoutForm').submit();">
                    <span class="material-symbols-outlined">logout</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- ============================
         Main Content
    ============================ -->
    <main class="flex-1 p-8 overflow-auto">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Gestión de Enfermeras</h2>
        </div>

        <!-- Alertas flotantes -->
        <div id="alertContainer" th:if="${success} or ${error}" class="fixed top-4 right-4 z-50 transition-opacity duration-500 opacity-100">
            <div th:if="${success}" class="flex items-center gap-3 p-4 rounded-lg shadow-md bg-green-100 text-green-800 animate-fadeIn">
                <span class="material-symbols-outlined">check_circle</span>
                <p th:text="${success}" class="font-medium"></p>
            </div>
            <div th:if="${error}" class="flex items-center gap-3 p-4 rounded-lg shadow-md bg-red-100 text-red-800 animate-fadeIn">
                <span class="material-symbols-outlined">error</span>
                <p th:text="${error}" class="font-medium"></p>
            </div>
        </div>

        <style>
            @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
            .animate-fadeIn { animation: fadeIn 0.3s ease-out; }
        </style>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Formulario lateral -->
            <div class="lg:col-span-1 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 max-h-[83vh] overflow-y-auto">
                <h3 id="formTitle" class="text-xl font-semibold mb-4 text-gray-900 dark:text-white">Agregar Enfermera</h3>

                <form id="formEnfermera" th:action="@{/hospitalito/enfermeras/editar}" th:object="${enfermeraDto}" method="post" class="space-y-4">
                    <input type="hidden" th:field="*{idEnfermera}" id="nurse-id-hidden">

                    <div>
                        <label class="block text-sm font-medium mb-1 text-gray-900 dark:text-white">Nombre</label>
                        <input type="text" th:field="*{nombre}" id="nurse-name" required
                               class="w-full pl-3 pr-3 py-2 rounded-lg border bg-gray-50 dark:bg-gray-900/50 border-gray-200 dark:border-gray-700/50 text-gray-900 dark:text-white "/>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-1 text-gray-900 dark:text-white">Apellido</label>
                        <input type="text" th:field="*{apellido}" id="nurse-lastname" required
                               class="w-full pl-3 pr-3 py-2 rounded-lg border bg-gray-50 dark:bg-gray-900/50 border-gray-200 dark:border-gray-700/50 text-gray-900 dark:text-white "/>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-1 text-gray-900 dark:text-white">DNI</label>
                        <input type="text" th:field="*{dni}" id="nurse-dni" required
                               class="w-full pl-3 pr-3 py-2 rounded-lg border bg-gray-50 dark:bg-gray-900/50 border-gray-200 dark:border-gray-700/50 text-gray-900 dark:text-white "/>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-1 text-gray-900 dark:text-white">Teléfono</label>
                        <input type="text" th:field="*{telefono}" id="nurse-phone" required
                               class="w-full pl-3 pr-3 py-2 rounded-lg border bg-gray-50 dark:bg-gray-900/50 border-gray-200 dark:border-gray-700/50 text-gray-900 dark:text-white "/>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-1 text-gray-900 dark:text-white">Estado</label>
                        <select th:field="*{activo}" id="nurse-active" required
                                class="w-full pl-3 pr-10 py-2 rounded-lg border bg-gray-50 dark:bg-gray-900/50 border-gray-200 dark:border-gray-700/50 text-gray-900 dark:text-white">
                            <option th:value="true">Activo</option>
                            <option th:value="false">Inactivo</option>
                        </select>
                    </div>

                    <div class="flex items-center justify-between pt-4">
                        <button id="submitBtn" type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90">Agregar</button>
                        <button id="btnEliminarNurse" type="button" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 hidden">Eliminar</button>
                        <button id="btnCancelarEdicion" type="button" class="px-4 py-2 bg-gray-400 dark:bg-gray-600 text-white rounded-lg hover:bg-gray-500 dark:hover:bg-gray-700 hidden">Cancelar</button>
                    </div>
                </form>
            </div>

            <!-- Tabla de enfermeras -->
            <div class="lg:col-span-2">
                <!-- Buscador -->
                <div class="mb-6">
                    <input id="searchInput"
                           placeholder="Buscar por nombre, telefono, DNI, activo o ID"
                           class="w-full pl-3 pr-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700/50 bg-white dark:bg-background-dark text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400"/>
                </div>

                <!-- Tabla -->
                <div class="max-h-[75vh] overflow-y-auto overflow-x-auto bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-md">
                    <table class="min-w-full text-sm text-left">
                        <thead class="bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
                        <tr>
                            <th class="px-6 py-3">ID</th>
                            <th class="px-6 py-3">Nombre Completo</th>
                            <th class="px-6 py-3">DNI</th>
                            <th class="px-6 py-3">Teléfono</th>
                            <th class="px-6 py-3 text-center">Estado</th>
                        </tr>
                        </thead>
                        <tbody id="enfermerasTableBody">
                        <tr class="border-b border-gray-200 dark:border-gray-700/50 hover:bg-gray-50/50 dark:hover:bg-gray-900/20 cursor-pointer"
                            th:each="enfermera : ${enfermeras}"
                            th:data-id="${enfermera.idEnfermera}">

                            <td class="px-6 py-4 text-gray-900 dark:text-white font-medium"
                                th:text="${enfermera.idEnfermera}"></td>

                            <td class="px-6 py-4 font-medium text-gray-900 dark:text-white"
                                th:text="${enfermera.nombre + ' ' + enfermera.apellido}"></td>

                            <td class="px-6 py-4 text-gray-600 dark:text-gray-400"
                                th:text="${enfermera.dni}"></td>

                            <td class="px-6 py-4 text-gray-600 dark:text-gray-400"
                                th:text="${enfermera.telefono}"></td>

                            <td class="px-6 py-4 text-center">
                        <span th:text="${enfermera.activo ? 'Activo' : 'Inactivo'}"
                              th:classappend="${enfermera.activo ? 'bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300' : 'bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300'}"
                              class="px-3 py-1 text-xs font-medium rounded-full"></span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Modales -->
        <!-- Confirmación Eliminación -->
        <div id="confirmModal" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50">
            <div class="bg-white dark:bg-background-dark p-6 rounded-lg shadow-xl w-80 text-center">
                <h3 class="text-lg font-semibold mb-3 text-gray-900 dark:text-white">Confirmar eliminación</h3>
                <p class="text-gray-600 dark:text-gray-300 mb-6">¿Estás seguro de que deseas eliminar esta enfermera?</p>
                <div class="flex justify-center gap-4">
                    <button id="cancelDelete" class="px-4 py-2 bg-gray-300 dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg hover:bg-gray-400 dark:hover:bg-gray-600">Cancelar</button>
                    <button id="confirmDelete" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">Eliminar</button>
                </div>
            </div>
        </div>

        <!-- Confirmación Inactivo -->
        <div id="modalInactivo" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white dark:bg-background-dark rounded-lg shadow-xl max-w-md w-full mx-4 transform transition-all">
                <div class="p-6">
                    <div class="flex items-center justify-center w-12 h-12 mx-auto bg-yellow-100 dark:bg-yellow-900/30 rounded-full mb-4">
                        <svg class="w-6 h-6 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                        </svg>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white text-center mb-2">¿Confirmar cambio a Inactivo?</h3>
                    <p class="text-gray-600 dark:text-gray-400 text-center mb-6">Si actualizas el personal a Inactivo, perderá todas sus asignaciones.</p>
                    <div class="flex gap-3">
                        <button id="cancelarInactivo" type="button" class="flex-1 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-white font-medium py-2 px-4 rounded-lg transition duration-200">Cancelar</button>
                        <button id="confirmarInactivo" type="button" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg transition duration-200">Aceptar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================
             SCRIPT PRINCIPAL
        ============================ -->
        <script th:src="@{/scripts/enfermeras.js}"></script>
    </main>
  </div>
</body>
</html>
